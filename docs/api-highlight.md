# 核心接口设计

## 接口规范

- 认证方式：JWT Token（请求头`Authorization: Bearer <token>`)
- 响应格式：统一JSON，按模块分类状态码（便于问题定位）
- 限流策略：秒杀接口50次/分钟，普通接口100次/分钟（Redis实现）



## 模块状态码

```markdown
| 模块     | 成功码 | 失败码 | 其他码 | 示例场景                     |
|----------|--------|--------|--------|------------------------------|
| 菜单     | 1000   | 1001   | 1002   | 菜单查询成功/失败/参数错误    |
| 商品     | 2000   | 2001   | 2002   | 商品搜索成功/库存不足/未找到  |
| 购物车   | 3000   | 3001   | 3002   | 加购成功/商品不存在/限购      |
| 用户     | 4000   | 4001   | 4002   | 登录成功/密码错误/未注册      |
| 评论     | 5000   | 5001   | 5002   | 评论成功/内容违规/权限不足    |
| 订单     | 6000   | 6001   | 6002   | 下单成功/支付失败/订单超时    |
| 地址     | 7000   | 7001   | 7002   | 地址保存成功/格式错误/超出数量|
| 秒杀     | 8000   | 8001   | 8002   | 秒杀成功/库存不足/请求排队    |
```



## 核心接口示例

### 秒杀参与接口

- **简要描述**：用户秒杀接口，此接口可以秒杀商品

- **请求URL**：`https:////www.nwq1309.shop/api/seckill/<task_id>`

- **返回示例**：

  ```json
  {
      code: 8000
      message: "秒杀成功！请在15分钟内支付"
      order_amount: 8599
      status: "success"task_id: "7ebd18e9-0166-4b60-b94c-2b1109f28f14"
      trade_no: "1765864547195"
  }
  ```

  

- **返回参数说明**：

| 参数名       | 类型      | 必返 | 说明                                                         |
| ------------ | --------- | ---- | ------------------------------------------------------------ |
| code         | int       | 是   | 响应状态码：✅ 8000 = 秒杀成功❌ 8001 = 秒杀失败（库存不足）❌ 8002 = 秒杀失败（活动未开始）❌ 8003 = 秒杀失败（活动已结束）❌ 8004 = 秒杀失败（重复参与）❌ 8005 = 秒杀失败（用户未登录 / 令牌失效）❌ 8006 = 秒杀失败（活动不存在） |
| message      | string    | 是   | 响应提示信息：成功时返回秒杀结果引导语，失败时返回具体失败原因（如 “库存不足，秒杀失败”“活动未开始，请等待”） |
| order_amount | int/float | 否   | 秒杀订单金额（单位：元）：✅ 秒杀成功时返回实际需支付的金额❌ 秒杀失败时返回 null / 不返回 |
| status       | string    | 是   | 秒杀结果状态：✅ success = 秒杀成功❌ failed = 秒杀失败⚠️ pending = 秒杀请求处理中（高并发场景临时返回） |
| task_id      | string    | 是   | 秒杀活动唯一标识（UUID 格式）：关联秒杀任务 ID，无论成功 / 失败均返回，用于问题排查、订单关联 |
| trade_no     | string    | 否   | 秒杀交易 / 订单编号（唯一）：✅ 秒杀成功时生成，用于后续支付、订单查询、取消订单等操作❌ 秒杀失败时返回 null / 不返回 |



### 商品参与接口

- **简要描述**：此接口用于查询单个商品
- **请求URL**：`https:////www.nwq1309.shop/api/goods/<goods_id>`
- **返回示例**：

```json
{
  "total": 619,
  "items": [
    {
      "name": "【清凉一夏】小米11手机散热器吃鸡神器背夹黑鲨pro冰封直播散热米10s/9红米K40/K30K20",
      "price": null,
      "stock": null,
      "status": 1,
      "type_id": 1,
      "sku_id": "10028383826715",
      "target_url": "https://item.jd.com/10028383826715.html",
      "jd_price": 18.9,
      "p_price": 18.9,
      "image": "10028383826715.jpg",
      "shop_name": "凡飞然二手影音专营店",
      "shop_id": 10235583,
      "spu_id": "10020831513336",
      "mk_price": 86,
      "vender_id": 10378200,
      "find": 1,
      "seckill_stock": 1005,
      "seckill_price": 15,
      "seckill_start_time": "2025-10-04T09:43:39",
      "seckill_end_time": "2025-11-21T09:43:46",
      "is_seckill": true,
      "id": 7,
      "create_time": "2024-10-02T14:35:01",
      "update_time": null
    }
```

- **返回参数说明**：

  | 参数名             | 类型        | 必返 | 说明                                                         |
  | ------------------ | ----------- | ---- | ------------------------------------------------------------ |
  | name               | string      | 是   | 商品名称（含营销标题，如 “【清凉一夏】小米 11 手机散热器...”） |
  | price              | null/float  | 是   | 商品基础售价：当前字段为 null，代表未配置基础价，优先取`jd_price`/`p_price`/`seckill_price` |
  | stock              | null/int    | 是   | 商品常规库存：当前字段为 null，代表常规库存未统计，秒杀场景优先参考`seckill_stock` |
  | status             | int         | 是   | 商品上架状态：✅ 1 = 上架（可购买 / 参与秒杀）❌ 0 = 下架（不可购买）❌ 2 = 违规封禁 |
  | type_id            | int         | 是   | 商品分类 ID：关联商品分类表，1 代表示例中的 “手机配件 / 散热器” 分类（可根据业务定义扩展） |
  | sku_id             | string      | 是   | 商品 SKU 唯一标识（京东 / 平台维度）：如 “10028383826715”，用于精准定位单个商品规格 |
  | target_url         | string      | 是   | 商品详情页链接（京东原链接）：点击可跳转至京东商品页         |
  | jd_price           | float       | 是   | 京东官方售价（单位：元）：如 18.9 代表 18.9 元               |
  | p_price            | float       | 是   | 平台售卖价（单位：元）：和京东价一致（18.9 元），代表平台同步京东售价 |
  | image              | string      | 是   | 商品主图文件名：需拼接图片 CDN 域名使用（如`https://xxx.360buyimg.com/10028383826715.jpg`） |
  | shop_name          | string      | 是   | 商品所属店铺名称：如 “凡飞然二手影音专营店”                  |
  | shop_id            | int         | 是   | 店铺唯一 ID：关联店铺表，10235583 为示例店铺 ID              |
  | spu_id             | string      | 是   | 商品 SPU 唯一标识（聚合 SKU 的父级 ID）：如 “10020831513336”，代表同一商品不同规格的聚合 ID |
  | mk_price           | int         | 是   | 商品市场指导价（单位：元）：86 代表该商品官方指导价 86 元，秒杀价 / 售价低于指导价 |
  | vender_id          | int         | 是   | 商家 / 供应商 ID：10378200 为示例供应商 ID，关联供应商表     |
  | find               | int         | 是   | 商品检索标识：1 代表该商品可被搜索到，0 代表屏蔽搜索（业务自定义字段） |
  | seckill_stock      | int         | 是   | 秒杀专属库存：1005 代表该商品剩余秒杀库存 1005 件，库存为 0 时无法参与秒杀 |
  | seckill_price      | int/float   | 是   | 秒杀专属价格（单位：元）：15 代表秒杀价 15 元，低于京东价 / 平台价 |
  | seckill_start_time | string      | 是   | 秒杀开始时间（UTC 格式）：“2025-10-04T09:43:39” 对应北京时间 2025-10-04 17:43:39（需前端时区转换） |
  | seckill_end_time   | string      | 是   | 秒杀结束时间（UTC 格式）：“2025-11-21T09:43:46” 对应北京时间 2025-11-21 17:43:46 |
  | is_seckill         | bool        | 是   | 是否为秒杀商品：✅ true = 是秒杀商品（展示秒杀标签、秒杀价）❌ false = 普通商品 |
  | id                 | int         | 是   | 平台商品主键 ID：7 为示例 ID，用于平台内商品增删改查、接口关联 |
  | create_time        | string      | 是   | 商品录入平台时间（UTC 格式）：“2024-10-02T14:35:01” 对应北京时间 2024-10-02 22:35:01 |
  | update_time        | null/string | 是   | 商品信息更新时间：null 代表该商品录入后未修改过，有修改时返回 UTC 格式时间 |



### 订单参与接口

- **简要描述**：此接口用于查询单个商品
- **请求URL**：`https:////www.nwq1309.shop/api/orders/<trade_no>`
- **返回示例**：

```json
{
  "total": 82,
  "items": [
    {
      "trade_no": "1759891426116",
      "email": "4@qq.com",
      "order_amount": 18.9,
      "address_id": null,
      "pay_status": "0",
      "pay_time": null,
      "ali_trade_no": null,
      "is_delete": 0,
      "id": 72,
      "create_time": "2025-10-08T02:43:46",
      "update_time": "2025-10-07T22:43:46",
      "user_name": "4@qq.com",
      "order_info": [
        {
          "sku_id": "10028383826715",
          "name": "【清凉一夏】小米11手机散热器吃鸡神器背夹黑鲨pro冰封直播散热米10s/9红米K40/K30K20",
          "price": 15,
          "goods_num": 1,
          "image": "10028383826715.jpg",
          "shop_name": "凡飞然二手影音专营店"
        }
      ],
      "goods_name": "【清凉一夏】小米11手机散热器吃鸡神器背夹黑鲨pro冰封直播散热米10s/9红米K40/K30K20",
      "goods_price": 18.9
    }
```

**返回参数说明**：

| 参数名       | 类型   | 说明                                                       |
| ------------ | ------ | ---------------------------------------------------------- |
| trade_no     | string | 订单唯一交易号（核心标识，用于支付 / 查单 / 退款）         |
| order_amount | float  | 订单实付金额（单位：元，如 18.9 代表 18.9 元）             |
| pay_status   | string | 支付状态：0 = 未支付，1 = 已支付，2 = 已退款，3 = 订单取消 |
| id           | int    | 平台订单主键 ID（内部操作 / 关联核心）                     |
| create_time  | string | 订单创建时间（UTC 格式，如 "2025-10-08T02:43:46"）         |
| user_name    | string | 下单用户（手机号 / 邮箱，如 "4@qq.com"）                   |
| order_info   | array  | 订单商品明细（核心），数组内参数见下表                     |
| goods_name   | string | 订单主商品名称（简化展示用）                               |



### 用户参与接口

- **简要描述**：此接口用于查询单个商品
- **请求URL**：`https:////www.nwq1309.shop/api/users/<email>`
- **返回示例**：

```json
{
  "total": 32,
  "items": [
    {
      "name": "测试账号1",
      "birthday": null,
      "mobile": "17724651407",
      "gender": "保密",
      "email": "2350496649@qq.com",
      "avatar": "http://www.nwq1309.shop/media/user_avatars/user_37_effff02a5571852a611ad16bf627e171.jpg",
      "background": "http://www.nwq1309.shop/media/user_backgrounds/user_37_a3db535aedfc90e6ef1294bd488d64c0.jpg",
      "is_active": true,
      "id": 37,
      "create_time": "2025-12-11T11:27:42",
      "update_time": "2025-12-11T19:36:47"
    }
```

**返回参数说明**：

| 参数名      | 类型   | 说明                                |
| ----------- | ------ | ----------------------------------- |
| total       | int    | 用户总数                            |
| items       | array  | 用户列表数组（无数据返回空数组）    |
| id          | int    | 用户唯一 ID（核心标识）             |
| name        | string | 用户名                              |
| mobile      | string | 手机号                              |
| email       | string | 邮箱                                |
| avatar      | string | 用户头像链接                        |
| is_active   | bool   | 账号状态：true = 激活，false = 禁用 |
| create_time | string | 用户创建时间（UTC 格式）            |